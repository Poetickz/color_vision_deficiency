from colormath.color_objects import sRGBColor, HSLColor
from colormath.color_conversions import convert_color

intensity_hsl = {259: 0.0890360618928935, 258: 0.2543277302096666, 257: 0.2668273442182119, 256: 0.22529688476137658, 255: 0.19109301707723209, 254: 0.16594151522625272, 253: 0.14306417974355812, 252: 0.12410337014226439, 251: 0.111643466351814, 250: 0.10417034501273933, 
249: 0.09723709252485913, 248: 0.0908017465655925, 247: 0.08476390412648174, 245: 0.07870322763771943, 243: 0.07334046638791672, 240: 0.05334949772188498, 237: 0.03291574730701857, 233: 0.027414158783169714, 231: 0.0211839637418565, 229: 0.0152436947463365, 
227: 0.009228899464869624, 225: 0.0032636213618713336, 224: 0.0, 222: 0.0, 221: 0.0, 219: 0.0, 217: 0.0, 215: 0.0, 214: 0.0, 212: 0.0, 
210: 0.0, 208: 0.0, 207: 0.0, 205: 0.0, 203: 0.0, 201: 0.0, 199: 0.0, 197: 0.0, 194: 0.0, 192: 0.0, 
189: 0.0, 187: 0.0, 184: 0.0, 181: 0.0, 179: 0.0, 176: 0.0, 173: 0.0, 171: 0.0, 168: 0.0, 166: 0.0, 
164: 0.0, 161: 0.0, 159: 0.0, 157: 0.0, 154: 0.0, 152: 0.0, 151: 0.005006688651884, 149: 0.011969811365385713, 147: 0.02032239579992314, 145: 0.030068125347769713, 
143: 0.041406944633452, 141: 0.054235201966917286, 139: 0.06865371947353628, 137: 0.08441725179754943, 134: 0.10146463116691642, 132: 0.11940347953054986, 129: 0.13797253412651914, 125: 0.15667108036029442, 120: 0.23717016202785962, 116: 0.225675901256224, 
106: 0.21316945584249863, 101: 0.19918848356288166, 97: 0.18492885730008243, 94: 0.16916618708564113, 91: 0.15247441871790415, 88: 0.13611031121645328, 85: 0.120589147470475, 83: 0.10539804329649571, 81: 0.08897686747826, 78: 0.075078024821475, 
76: 0.062234602546184715, 74: 0.05144737331123184, 71: 0.04100794524851638, 69: 0.0318383030792505, 67: 0.0238896293420665, 65: 0.017072443517987833, 63: 0.01134271440032525, 60: 0.006539354683617166, 58: 0.002843946544978143, 56: 0.0, 
54: 0.0, 52: 0.0, 50: 0.0, 49: 0.0, 47: 0.0, 45: 0.0, 44: 0.0, 42: 0.0, 41: 0.0, 40: 0.0, 
38: 0.0, 37: 0.0, 36: 0.0, 35: 0.0, 34: 0.0, 32: 0.0, 31: 0.0, 30: 0.0, 29: 0.0, 28: 0.0, 
27: 0.0, 26: 0.0, 25: 0.0005931232408913967, 24: 0.004876149188947857, 23: 0.010539018996576143, 22: 0.01760566586411043, 21: 0.026515155352900287, 20: 0.03647104126737683, 19: 0.04951813278525712, 18: 0.0647561804238495, 
17: 0.08272956836841237, 16: 0.10309912612601983, 15: 0.124569376738138, 14: 0.14939981637785113, 12: 0.17691993619206373, 11: 0.2056250852722177, 10: 0.23573532277264558, 8: 0.263909651664485, 7: 0.2942517408209965, 4: 0.3234759032863223, 
1: 0.349377927190955, 0: 0.5098813707496807}

def modify_rgb(rgb_tuple, level=0.5):
    rgb = rgb_int_to_float(rgb_tuple)
    rgb_class = sRGBColor(rgb[0], rgb[1], rgb[2])
    hsl = convert_color(rgb_class, HSLColor).get_value_tuple()
    intensity = find_apx_intensity(int(hsl[0]))
    new_hsl = convert(hsl, intensity, level)
    new_hsl = HSLColor(new_hsl[0],new_hsl[1],new_hsl[2])
    new_rgb = convert_color(new_hsl, sRGBColor).get_value_tuple()
    new_rgb_int = rgb_float_to_int(new_rgb)
    return new_rgb_int


def find_apx_intensity(id_value):
    return min(intensity_hsl, key=lambda x:abs(x-id_value))

def convert(rgb_tuple, intensity, level):
    if intensity >= 0:
        return (rgb_tuple[0], brigthness_level(rgb_tuple[1],intensity_hsl[intensity],level), rgb_tuple[2])
        
def brigthness_level(color, downgrade, level):
    print(level, downgrade)
    print((color*level)*(1 + downgrade))
    return (color*level)*(1 + downgrade)

def rgb_int_to_float(rgb_int):
    return (float(rgb_int[0]/255.00000), float(rgb_int[1]/255.00000),  float(rgb_int[2]/255.00000))

def rgb_float_to_int(rgb):
    return (int(rgb[0]*255), int(rgb[1]*255),  int(rgb[2]*255))